jQuery(document).ready((function(t){"use strict";let n={export_btn:t(".metform-pdf-export-btn"),margin:30,font_size:8,unit:"px"};t.extend(n,{init:function(){this.getEntryData()},getEntryData:function(){this.export_btn.on("click",(t=>{t.preventDefault(),t.stopPropagation();const n=t.target.dataset.restApi;t.target.classList.add("loading"),fetch(n).then((t=>t.json())).then((n=>{if(!n.form_data||!n.form_inputs)return!1;Object.keys(n.form_data).length>0&&(this.pdf=null,this.pdf=new jsPDF("p",this.unit),this.signature=[],this.post_id=t.target.dataset.id,this.post_json=n,this.createPDFmarkup())}))}))},createPDFmarkup:function(){const t=new Promise(((t,n)=>{t(`<table border="1" cellspacing="0" style="font-size:${this.font_size}${this.unit};">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th align="left">Label</th>\n\t\t\t\t\t\t\t<th align="left">Value</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t${(()=>{var t="";const{form_data:n,form_inputs:e}=this.post_json;for(const i of Object.values(e)){const{widgetType:e,mf_input_label:s,mf_input_name:a}=i;n[a]!==undefined&&("mf-signature"!==e&&"mf-credit-card"!==e?t+=`<tr> \n\t\t\t\t\t\t\t\t\t<td>${s}</td> \n\t\t\t\t\t\t\t\t\t<td>${n[a]}</td> \n\t\t\t\t\t\t\t\t</tr>`:"mf-credit-card"===e?t+=`<tr> \n\t\t\t\t\t\t\t\t\t<td>${s}</td> \n\t\t\t\t\t\t\t\t\t<td>${n[a]}</td> \n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr> \n\t\t\t\t\t\t\t\t\t<td>${s} Type</td> \n\t\t\t\t\t\t\t\t\t<td>${n[a+"--type"]}</td> \n\t\t\t\t\t\t\t\t</tr>`:this.signature.push([s,n[a]]))}return t}).call(this)}\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>`)}));this.get_pdf(t)},get_pdf:async function(t){const n=this;t.then((t=>{if(n.pdf.fromHTML(t,n.margin,20),n.signature.length){let t=30;n.signature.map((([e,i],s)=>{s=0===s?1:s;const a=new Image;a.src=i,a.onload=function(){n.pdf.text(e,t+10,n.pdf.lastCellPos.y+n.margin),n.pdf.addImage(a,"PNG",t,n.pdf.lastCellPos.y+n.margin,201,50),t+=90}}))}return!0})).then((()=>{setTimeout((()=>{n.pdf.save(`Entry # ${n.post_id}.pdf`),this.export_btn.removeClass("loading")}),300)}))}}).init()}));